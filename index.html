<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Lectio Divina do Evangelho do Dia. Ideal para sua oração diária e reflexão católica.">
  <meta name="keywords" content="liturgia diária, liturgia da diária, evangelho do dia, evangelho de hoje, liturgia de hoje, evangelho dia, evangelho, lectio divina, evangelho do dia de hoje, o evangelho de hoje, liturgia diaria hoje, liturgia diária hoje, liturgia diaria de hoje, divina lectio, divino lectio, evangelho de hoje do dia, evangelho dia de hoje, liturgia do dia de hoje, evangelho do dia comentado, liturgia diária comentada de hoje, evangelho no lar, liturgia do ordinário, liturgia diaria comentada, o evangelho do dia, lectio divina de hoje, evangelho hoje, evangelho do lar">
  <meta name="author" content="Liturgia Diária">
  <title>Evangelho do Dia e Lectio Divina - Liturgia Diária</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="https://liturgiadiaria.top/" />
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
  <script defer data-domain="liturgiadiaria.top" src="https://plausible.io/js/plausible.js"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    /* Variáveis CSS para cores */
    :root {
      --primary: #6a1b9a; /* Cor principal do liturgiadiaria.top */
      --background-light: #f4f4f4;
      --text-dark: #333333;
      --text-light-gray: #888888;
      --card-background: #ffffff;
      --shadow-light: rgba(0,0,0,0.05);
      --shadow-medium: rgba(0,0,0,0.1);
    }

    /* Estilos globais */
    body {
      font-family: 'Open Sans', sans-serif; /* Usa a fonte Open Sans */
      background-color: var(--background-light);
      color: var(--text-dark);
      max-width: 800px;
      margin: auto;
      padding: 2em;
      line-height: 1.6;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Roboto', sans-serif; /* Usa a fonte Roboto para títulos */
      color: var(--text-dark);
    }
    h1 {
      text-align: center;
      margin-top: 0;
      font-size: 2.25rem; /* text-4xl */
      font-weight: 700; /* font-bold */
      margin-bottom: 1.5rem; /* mb-6 */
    }
    a {
      color: var(--primary);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* Estilos para botões */
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 0.625rem 0.9375rem; /* 10px 15px */
      border-radius: 0.3125rem; /* 5px */
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s ease-in-out;
    }
    button:hover {
      background-color: #4a126b; /* Cor mais escura para hover */
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Estilos para o container do evangelho */
    #evangelho {
      background: var(--card-background);
      padding: 1.5rem; /* p-6 */
      border-radius: 0.5rem; /* rounded-lg */
      box-shadow: 0 4px 6px -1px var(--shadow-light), 0 2px 4px -2px var(--shadow-light); /* shadow-md */
    }

    /* Estilos para o conteúdo do evangelho (dentro de #evangelho) */
    #evangelho h2 {
      font-size: 1.5rem; /* text-2xl */
      font-weight: 700; /* font-bold */
      margin-bottom: 1rem; /* mb-4 */
    }
    #evangelho h3 {
      font-size: 1.25rem; /* text-xl */
      font-weight: 600; /* font-semibold */
      margin-top: 1.5rem; /* mt-6 */
      margin-bottom: 0.75rem; /* mb-3 */
      color: var(--primary);
    }
    #evangelho p {
      margin-bottom: 1rem; /* mb-4 */
      line-height: 1.75; /* leading-relaxed */
    }
    #evangelho strong {
      font-weight: 600; /* font-semibold */
    }

    /* Estilos para o rodapé */
    footer {
      margin-top: 3rem; /* mt-12 */
      text-align: center;
      font-size: 0.875em; /* text-sm */
      color: var(--text-light-gray);
    }

    /* Layout de botões de navegação */
    #nav-botoes {
      display: flex;
      justify-content: flex-start; /* flex justify-start */
      margin-bottom: 1rem; /* mb-4 */
    }

    /* Estilos para links de redes sociais */
    .social-links {
      margin-top: 2rem; /* mt-8 */
      text-align: center;
      color: var(--text-dark);
    }
    .social-links p {
      margin-bottom: 0.5rem; /* mb-2 */
    }
    .social-links a {
      margin: 0 0.5rem; /* space-x-4 */
    }

    /* Estilos para o banner */
    .banner-container {
      margin-top: 2rem; /* mt-8 */
      text-align: center;
    }
    .banner-container img {
      max-width: 100%;
      height: auto;
      border-radius: 0.5rem; /* rounded-lg */
      box-shadow: 0 1px 2px 0 var(--shadow-light), 0 1px 1px -1px var(--shadow-light); /* shadow-sm */
      margin: auto; /* mx-auto */
    }
  </style>
</head>
<body>
  <main>
    <h1 id="titulo">Carregando...</h1>

    <div id="nav-botoes">
      <button onclick="navegar(1)" id="proximo">&larr; Dia anterior</button>
    </div>

    <div id="evangelho">Carregando...</div>

    <div style="margin-top: 1.5rem; text-align: center">
      <button onclick="compartilhar()">Compartilhar</button>
    </div>

    <div class="social-links">
      <p>Siga nossas redes sociais:</p>
      <p>
        <a href="https://link.liturgiadiaria.top/telegram-liturgiadiariachatbot" target="_blank" rel="noopener noreferrer">Telegram</a> |
        <a href="https://link.liturgiadiaria.top/youtube-liturgiadadiaria" target="_blank" rel="noopener noreferrer">YouTube</a> |
        <a href="https://link.liturgiadiaria.top/instagram-liturgiadadiaria" target="_blank" rel="noopener noreferrer">Instagram</a> |
        <a href="https://link.liturgiadiaria.top/whatsapp-canal-liturgia" target="_blank" rel="noopener noreferrer">WhatsApp</a> |
        <a href="https://link.liturgiadiaria.top/facebook-liturgiadadiaria" target="_blank" rel="noopener noreferrer">Facebook</a>
      </p>
    </div>

    <div class="banner-container">
      <a href="https://link.liturgiadiaria.top/ofertas-exclusivas-tecinova" target="_blank" rel="noopener noreferrer">
        <img src="https://liturgiadiaria.top/banner-ofertas-exclusivas.webp" alt="Confira ofertas exclusivas" />
      </a>
    </div>

    <footer>
      Fonte: aliturgia.com<br>
      <a href="https://liturgiadiaria.top/" target="_blank" rel="noopener noreferrer">&copy; 2025 Liturgia Diária - Todos os direitos reservados</a>
    </footer>
  </main>

  <script>
    let indexAtual = 0;
    let postsSummary = [];
    let currentPostContent = null;
    let loadingSummary = true;
    let loadingContent = false;
    let error = null;

    const PROXY_URL = "https://api.allorigins.win/get?url=";
    const FEED_URL = "https://aliturgia.com/feed/";

    // Chaves e tempos de expiração para o cache
    const CACHE_KEY_SUMMARY = "lectio_rss_summary";
    const CACHE_KEY_PREFIX_CONTENT = "lectio_post_content_";
    const CACHE_EXPIRATION_SUMMARY_MS = 60 * 60 * 1000; // 1 hora
    const CACHE_EXPIRATION_CONTENT_MS = 24 * 60 * 60 * 1000; // 24 horas

    // Elementos DOM
    const tituloEl = document.getElementById("titulo");
    const evangelhoEl = document.getElementById("evangelho");
    const proximoBtn = document.getElementById("proximo");
    const compartilharBtn = document.querySelector('button[onclick="compartilhar()"]');

    function updateUI() {
      tituloEl.textContent = loadingSummary || !currentPostContent
        ? "Carregando..."
        : currentPostContent.title || "Evangelho do Dia e Lectio Divina";

      if (loadingSummary || loadingContent) {
        evangelhoEl.innerHTML = "<p>Carregando conteúdo...</p>";
      } else if (error) {
        evangelhoEl.innerHTML = `<p style="color: red;">${error}</p>`;
      } else if (currentPostContent) {
        evangelhoEl.innerHTML = currentPostContent.content;
      } else {
        evangelhoEl.innerHTML = "<p>Nenhum conteúdo disponível.</p>";
      }

      proximoBtn.disabled = indexAtual >= postsSummary.length - 1 || loadingSummary || loadingContent;
      compartilharBtn.disabled = !currentPostContent;
    }

    async function fetchPostsSummary() {
      loadingSummary = true;
      error = null;
      updateUI();

      // Tenta carregar do cache
      try {
        const cachedData = localStorage.getItem(CACHE_KEY_SUMMARY);
        if (cachedData) {
          const { timestamp, data } = JSON.parse(cachedData);
          if (Date.now() - timestamp < CACHE_EXPIRATION_SUMMARY_MS) {
            postsSummary = data;
            console.log("Lista de posts carregada do cache.");
            loadingSummary = false;
            updateUI();
            if (postsSummary.length > 0) {
              fetchAndDisplayPostContent(postsSummary[indexAtual]);
            }
            return;
          }
        }
      } catch (e) {
        console.warn("Erro ao ler cache da lista de posts:", e);
        localStorage.removeItem(CACHE_KEY_SUMMARY); // Limpa cache inválido
      }

      // Se não houver cache válido, busca do proxy
      try {
        const feedRes = await fetch(PROXY_URL + encodeURIComponent(FEED_URL));
        if (!feedRes.ok) {
          throw new Error(`Falha ao carregar a lista de posts: ${feedRes.statusText}`);
        }
        const feedData = await feedRes.json();
        const xmlContent = feedData.contents;

        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlContent, "application/xml");
        
        postsSummary = [...xmlDoc.querySelectorAll("item")].map(item => ({
          title: item.querySelector("title")?.textContent || "",
          link: item.querySelector("link")?.textContent || ""
        }));
        
        // Armazena no cache
        try {
          localStorage.setItem(CACHE_KEY_SUMMARY, JSON.stringify({ timestamp: Date.now(), data: postsSummary }));
          console.log("Lista de posts armazenada no cache.");
        } catch (e) {
          console.warn("Erro ao armazenar lista de posts no cache:", e);
        }

        indexAtual = 0; // Reset para o post mais recente
      } catch (err) {
        console.error("Erro ao buscar posts:", err);
        error = "Erro ao carregar a lista de posts. Tente novamente mais tarde.";
      } finally {
        loadingSummary = false;
        updateUI();
        if (postsSummary.length > 0) {
          fetchAndDisplayPostContent(postsSummary[indexAtual]);
        }
      }
    }

    async function fetchAndDisplayPostContent(post) {
      loadingContent = true;
      error = null;
      currentPostContent = null;
      updateUI();

      const contentCacheKey = CACHE_KEY_PREFIX_CONTENT + btoa(post.link); // Usa base64 para link como chave

      // Tenta carregar do cache
      try {
        const cachedData = localStorage.getItem(contentCacheKey);
        if (cachedData) {
          const { timestamp, content } = JSON.parse(cachedData);
          if (Date.now() - timestamp < CACHE_EXPIRATION_CONTENT_MS) {
            currentPostContent = { ...post, content };
            console.log(`Conteúdo do post "${post.title}" carregado do cache.`);
            loadingContent = false;
            updateUI();
            return;
          }
        }
      } catch (e) {
        console.warn(`Erro ao ler cache do post "${post.title}":`, e);
        localStorage.removeItem(contentCacheKey); // Limpa cache inválido
      }

      // Se não houver cache válido, busca do proxy
      try {
        const proxiedUrl = PROXY_URL + encodeURIComponent(post.link);
        const res = await fetch(proxiedUrl);
        const data = await res.json();
        const postDoc = new DOMParser().parseFromString(data.contents, "text/html");
        const article = postDoc.querySelector("article");

        let content = "Conteúdo não encontrado.";
        if (article) {
          const nodes = [...article.querySelectorAll("h2, h3, strong, p")];
          const startIndex = nodes.findIndex((n) => /^Evangelho/i.test(n.textContent?.trim() || ""));

          if (startIndex !== -1) {
            let recorteHTML = "";
            const textoUsado = new Set();
            for (let i = startIndex; i < nodes.length; i++) {
              const texto = nodes[i].textContent?.trim() || "";
              if (!texto || textoUsado.has(texto)) continue;
              if (/Share:|Partilhar:/i.test(texto)) break;
              if (/^compreender a palavra$|^meditar a palavra$|^rezar a palavra$|^compromisso$|^compromisso semanal$/i.test(texto)) continue;
              recorteHTML += nodes[i].outerHTML;
              textoUsado.add(texto);
            }

            content = recorteHTML
              .replace(/(<[^>]*>\s*)?(compreender a palavra)(\s*<[^>]*>)?/gi, "<h3> Compreender a Palavra</h3>")
              .replace(/(<[^>]*>\s*)?(meditar a palavra)(\s*<[^>]*>)?/gi, "<h3> Meditar a Palavra</h3>")
              .replace(/(<[^>]*>\s*)?(rezar a palavra)(\s*<[^>]*>)?/gi, "<h3> Rezar a Palavra</h3>")
              .replace(/(<[^>]*>\s*)?(compromisso)(\s*<[^>]*>)?/gi, "<h3> Compromisso</h3>")
              .replace(/(<[^>]*>\s*)?(compromisso semanal)(\s*<[^>]*>)?/gi, "<h3> Compromisso Semanal</h3>"); // Nova regra para "Compromisso Semanal"
          }
        }
        currentPostContent = { ...post, content };

        // Armazena no cache
        try {
          localStorage.setItem(contentCacheKey, JSON.stringify({ timestamp: Date.now(), content: content }));
          console.log(`Conteúdo do post "${post.title}" armazenado no cache.`);
        } catch (e) {
          console.warn(`Erro ao armazenar conteúdo do post "${post.title}" no cache:`, e);
        }

      } catch (e) {
        console.error("Erro ao carregar o conteúdo do post:", e);
        error = "Erro ao carregar o conteúdo do post.";
        currentPostContent = null;
      } finally {
        loadingContent = false;
        updateUI();
      }
    }

    function navegar(delta) {
      const novoIndex = indexAtual + delta;
      if (novoIndex >= 0 && novoIndex < postsSummary.length) {
        indexAtual = novoIndex;
        updateUI(); // Atualiza UI imediatamente para mostrar "Carregando..."
        fetchAndDisplayPostContent(postsSummary[indexAtual]);
      }
    }

    function compartilhar() {
      if (!currentPostContent) return;

      const titulo = currentPostContent.title;
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = currentPostContent.content;
      
      // Processa o conteúdo para melhor formatação
      let conteudo = tempDiv.innerText
        .replace(/\n\s*\n/g, '\n\n') // Normaliza quebras de linha duplas
        .replace(/\n{3,}/g, '\n\n') // Remove quebras de linha excessivas
        .trim(); // Remove espaços em branco no início e fim

      // Adiciona emojis e formatação especial para as seções
      conteudo = conteudo
        .replace(/Compreender a Palavra/gi, "\n💡 *Compreender a Palavra*\n")
        .replace(/Meditar a Palavra/gi, "\n🧠 *Meditar a Palavra*\n")
        .replace(/Rezar a Palavra/gi, "\n🙏 *Rezar a Palavra*\n")
        .replace(/Compromisso Semanal/gi, "\n📌 *Compromisso Semanal*\n")
        .replace(/Compromisso(?!\s+Semanal)/gi, "\n📌 *Compromisso*\n");

      // Formata o texto final
      const texto = `📖 *${titulo}*

${conteudo}

---
📱 Acesse mais conteúdos em: www.liturgiadiaria.top
🙏 Compartilhe esta reflexão com outros fiéis!`;

      const fallback = () => {
        navigator.clipboard
          .writeText(texto)
          .then(() => alert("📋 Conteúdo copiado para a área de transferência!"))
          .catch(() => alert("Não foi possível copiar. Copie manualmente."));
      };

      if (window.isSecureContext && navigator.canShare && navigator.canShare({ text: texto })) {
        navigator
          .share({
            title: titulo,
            text: texto,
            url: location.href,
          })
          .catch(fallback);
      } else {
        fallback();
      }
    }

    // Inicializa o carregamento do feed ao carregar a página
    document.addEventListener("DOMContentLoaded", fetchPostsSummary);
  </script>
</body>
</html>
